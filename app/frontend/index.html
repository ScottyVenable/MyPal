<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pal ‚Äî Evolving AI Companion</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script type="module" src="app.js" defer></script>
</head>
<body>
  <header>
    <h1>Pal</h1>
    <nav>
      <button type="button" data-tab="chat" class="active">Conversation</button>
      <button type="button" data-tab="stats">Stats</button>
      <button type="button" data-tab="brain">Brain</button>
      <button type="button" data-tab="journal">Journal</button>
      <button type="button" data-tab="settings">Settings</button>
    </nav>
  </header>

  <main>
    <section id="tab-chat" class="tab active">
      <div class="emotion-display" id="emotion-display">
        <div class="emotion-icon" id="emotion-icon">üòä</div>
        <div class="emotion-details">
          <div class="emotion-mood" id="emotion-mood">Pal is calm</div>
          <div class="emotion-bar">
            <div class="emotion-fill" id="emotion-fill" style="width: 50%"></div>
          </div>
        </div>
      </div>
      <div class="chat-tools">
        <input id="chat-search" placeholder="Search chat history..." autocomplete="off" />
        <button id="chat-search-btn" type="button">Search</button>
        <button id="chat-search-clear" type="button">Clear</button>
      </div>
      <div id="chat-search-results" class="search-results hidden" aria-live="polite"></div>
      <div id="chat-window"></div>
      <form id="chat-form">
        <input id="chat-input" placeholder="Teach Pal‚Ä¶" autocomplete="off" />
        <button type="submit">Send</button>
      </form>
    </section>

    <section id="tab-stats" class="tab">
      <div class="pal-advancement-card">
        <h3>Pal Advancement</h3>
        <div class="advancement-content">
          <div class="advancement-info">
            <div class="advancement-row">
              <span class="advancement-label">Current Level</span>
              <span class="advancement-value" id="advancement-level">0</span>
            </div>
            <div class="advancement-row">
              <span class="advancement-label">Experience Points</span>
              <span class="advancement-value" id="advancement-xp">0 / 100</span>
            </div>
            <div class="advancement-row">
              <span class="advancement-label">XP to Next Level</span>
              <span class="advancement-value highlight" id="advancement-remaining">100</span>
            </div>
          </div>
          <div class="advancement-progress">
            <div class="progress-bar-container">
              <div class="progress-bar-fill" id="advancement-progress-bar" style="width: 0%"></div>
              <div class="progress-bar-text" id="advancement-progress-text">0%</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="stats">
        <div class="stat-box">
          <div>Level</div>
          <div id="stat-level">0</div>
        </div>
        <div class="stat-box">
          <div>XP</div>
          <div id="stat-xp">0</div>
        </div>
        <div class="stat-box">
          <div>CP</div>
          <div id="stat-cp">0</div>
        </div>
        <div class="stat-box">
          <div>Vocabulary</div>
          <div id="stat-vocab">0</div>
        </div>
      </div>
      
      <div class="current-emotion-card">
        <h3>Current Emotional State</h3>
        <div class="emotion-display-large">
          <div class="emotion-icon-large" id="stat-emotion-icon">üòä</div>
          <div class="emotion-info">
            <div class="emotion-label">Mood</div>
            <div class="emotion-value" id="stat-emotion-mood">Calm</div>
            <div class="emotion-label">Intensity</div>
            <div class="emotion-bar-large">
              <div class="emotion-fill" id="stat-emotion-fill" style="width: 50%"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="progress-dashboard">
        <div class="chart-card">
          <h3>XP Over Time</h3>
          <canvas id="xpChart" height="200"></canvas>
        </div>
        <div class="chart-card">
          <h3>Conversations per Day</h3>
          <canvas id="convoChart" height="200"></canvas>
        </div>
      </div>
      
      <canvas id="personalityChart" width="400" height="400"></canvas>
    </section>

    <section id="tab-brain" class="tab">
      <div class="brain-toolbar">
        <button id="refresh-brain" type="button">Refresh Graph</button>
        <span id="brain-summary">Nodes: 0 ¬∑ Links: 0 ¬∑ Memories: 0</span>
      </div>
      <div class="brain-layout">
        <div class="brain-graph-card">
          <div id="brain-graph"></div>
        </div>
        <aside class="brain-sidebar">
          <div class="brain-info">
            <h3>How to read this graph</h3>
            <p id="brain-description">Nodes represent the words and concepts Pal hears most often. Links connect words that commonly appear together.</p>
            <ul>
              <li><strong>Size</strong>: frequency of the word.</li>
              <li><strong>Color</strong>: interaction recency.</li>
              <li><strong>Edges</strong>: shared context strength.</li>
            </ul>
          </div>
          <div class="brain-memories">
            <div class="brain-memories-header">
              <h3>Recent Memories <span class="help-icon" title="Memories are important interactions stored by Pal. Click on a memory to see Pal's subjective perspective of how it felt during that moment. Sentiment shows emotional tone, keywords show main concepts.">‚ìò</span></h3>
            </div>
            <div id="memory-list" class="memory-list"></div>
          </div>
        </aside>
      </div>
    </section>

    <section id="tab-journal" class="tab">
      <div class="journal-toolbar">
        <button id="refresh-journal" type="button">Refresh</button>
        <span id="journal-summary">Thoughts: 0</span>
        <span class="help-icon" title="Journal shows Pal's internal thought process for each interaction. Strategy shows how Pal decided to respond, Focus shows what concept Pal was thinking about, and Reasoning explains Pal's logic.">‚ìò</span>
      </div>
      <div id="journal-entries" class="journal-list"></div>
    </section>

    <section id="tab-settings" class="tab">
      <div class="settings-container">
        <h2>Settings</h2>
        
        <div class="settings-section">
          <h3>Learning & Development</h3>
          <label class="slider-group">
            <span>Learning Speed Multiplier</span>
            <input id="xp-multiplier" type="range" min="1" max="250" value="1" />
            <span id="xp-multiplier-value">1x</span>
          </label>
          <p class="help-text">Controls how quickly Pal gains XP and levels up. Higher values = faster development.</p>
        </div>

        <div class="settings-section">
          <h3>AI Provider</h3>
          <label>
            <span>Provider</span>
            <select id="api-provider">
              <option value="local">Local Only (default)</option>
              <option value="openai">OpenAI</option>
              <option value="azure">Azure OpenAI</option>
              <option value="gemini">Google Gemini</option>
            </select>
          </label>
          <label>
            <span>API Key</span>
            <input id="api-key" type="password" placeholder="Optional ‚Äî stored locally" />
          </label>
          <p class="help-text">Optional: Configure external AI provider for enhanced responses at higher levels.</p>
        </div>

        <div class="settings-section">
          <h3>Privacy & Security</h3>
          <label class="checkbox-label">
            <input id="telemetry" type="checkbox" />
            <span>Enable Telemetry (opt-in)</span>
          </label>
          <label class="checkbox-label">
            <input id="auth-required" type="checkbox" />
            <span>Require login for sensitive actions</span>
          </label>
          <p class="help-text">Telemetry helps improve MyPal. All data stays local unless explicitly enabled.</p>
        </div>

        <div class="settings-section">
          <h3>Actions</h3>
          <div class="settings-actions">
            <button id="save-settings" class="primary">Save Settings</button>
            <button id="export-memory">Export Memory</button>
            <button id="reset-pal" class="danger">Reset Pal</button>
          </div>
          <p class="help-text danger-text">‚ö†Ô∏è Reset Pal will permanently delete all data, conversations, and progress.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <small>Stage 0‚Äì1 MVP ‚Äî Local prototype</small>
  </footer>

  <!-- Connectivity/status modal -->
  <div id="status-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="status-title">
    <div class="modal-card">
      <h2 id="status-title">Backend Not Reachable</h2>
      <p>
        The local server at <code>http://localhost:3001</code> is not responding.
        Please start the backend (see README) and try again.
      </p>
      <div class="modal-actions">
        <button id="retry-connection" type="button">Retry</button>
        <button id="dismiss-connection" type="button">Dismiss</button>
      </div>
    </div>
  </div>

  <!-- Developer tools panel (toggle with Ctrl+D) -->
  <div id="dev-panel" class="dev-panel hidden">
    <div class="dev-row"><strong>Backend:</strong> <span id="dev-backend-status">unknown</span></div>
    <div class="dev-row"><strong>API Provider:</strong> <span id="dev-api-provider">local</span></div>
    <div class="dev-row"><button id="dev-ping" type="button">Ping Health</button></div>
    <div class="dev-row">
      <input id="auth-user" placeholder="username" />
      <input id="auth-pass" placeholder="password" type="password" />
      <button id="auth-register" type="button">Register</button>
      <button id="auth-login" type="button">Login</button>
      <button id="auth-logout" type="button">Logout</button>
    </div>
    <div class="dev-row"><small id="auth-status">Not logged in</small></div>
  </div>

  <!-- Graph library -->
  <script src="https://unpkg.com/vis-network@9.1.9/standalone/umd/vis-network.min.js"></script>
</body>
</html>
