<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' tauri:; script-src 'self' https://cdn.jsdelivr.net https://unpkg.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' http://localhost:3001 http://127.0.0.1:3001 ws://localhost:3001 ws://127.0.0.1:3001 https://cdn.jsdelivr.net tauri:; img-src 'self' data: tauri: asset: https:; font-src 'self' data: http://localhost:3001;" />
  <title>Pal — Evolving AI Companion</title>
  <link rel="icon" href="../media/images/icon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="services/perf.js"></script>
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
      "3d-force-graph": "https://cdn.jsdelivr.net/npm/3d-force-graph@1.73.3/+esm"
    }
  }
  </script>
  <script type="module" src="app.js" defer></script>
</head>
<body>
  <!-- Startup Loader Overlay -->
  <div id="boot-loader" class="boot-loader" role="status" aria-live="polite">
    <div class="boot-loader-card">
      <img src="../media/images/logos/v2/logo_v2_transparent.png" alt="MyPal Logo" class="boot-loader-logo" />
      <h2 id="boot-loader-stage" class="boot-loader-stage">Starting MyPal...</h2>
      <p id="boot-loader-detail" class="boot-loader-detail">Preparing local systems.</p>
      <div class="boot-loader-spinner" aria-hidden="true"></div>
      <p id="boot-loader-error" class="boot-loader-error hidden"></p>
      <div class="boot-loader-actions">
        <button id="boot-loader-help" type="button" class="btn-secondary hidden">View troubleshooting</button>
      </div>
    </div>
  </div>

  <!-- Profile Selection Menu -->
  <div id="profile-menu" class="profile-menu">
    <div class="profile-menu-content">
      <div class="profile-menu-logo">
        <img src="../media/images/logos/v2/logo_v2_transparent.png" alt="MyPal Logo" />
      </div>
      <h1 class="profile-title">Welcome to MyPal</h1>
      <p class="profile-subtitle">Choose your Pal or create a new one</p>
      
      <div id="continue-section" class="continue-section hidden">
        <button id="continue-btn" class="btn-primary btn-large" type="button">
          Continue with <span id="continue-name">My Pal</span>
        </button>
        <div id="continue-meta" class="continue-meta hidden"></div>
      </div>
      
      <div class="profile-actions">
        <button id="new-pal-btn" class="btn-secondary" type="button">+ New Pal</button>
        <button id="load-pal-btn" class="btn-secondary" type="button">Load Pal</button>
      </div>
      
      <div id="profile-cards" class="profile-cards hidden"></div>
    </div>
  </div>
  
  <!-- New Pal Modal -->
  <div id="new-pal-modal" class="modal hidden">
    <div class="modal-content">
      <h2>Create New Pal</h2>
      <form id="new-pal-form">
        <label for="new-pal-name">Pal Name</label>
        <input id="new-pal-name" type="text" placeholder="Enter a name..." maxlength="30" required autofocus />
        <div class="form-hint">Maximum 30 characters</div>
        <div id="new-pal-error" class="form-error hidden"></div>
        <div class="modal-actions">
          <button type="submit" class="btn-primary">Create</button>
          <button type="button" id="new-pal-cancel" class="btn-secondary">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Main App (hidden until profile loaded) -->
  <div id="main-app" class="hidden">
  <header>
    <div class="header-left">
      <img src="../media/images/logos/v2/logo_v2_transparent.png" alt="MyPal" class="header-logo" />
      <h1>MyPal</h1>
      <span id="current-profile-name" class="profile-badge"></span>
    </div>
    <nav>
      <button type="button" data-tab="chat" class="active">Conversation</button>
      <button type="button" data-tab="stats">Stats</button>
      <button type="button" data-tab="brain">Brain</button>
      <button type="button" data-tab="journal">Journal</button>
      <button type="button" data-tab="settings">Settings</button>
    </nav>
    <button id="exit-to-menu" class="exit-btn" type="button" title="Exit to Profile Menu">⬅ Exit</button>
  </header>

  <main>
    <section id="tab-chat" class="tab active">
      <div class="chat-layout">
        <div class="chat-column chat-conversation">
          <div class="chat-tools">
            <input id="chat-search" placeholder="Search chat history..." autocomplete="off" />
            <button id="chat-search-btn" type="button">Search</button>
            <button id="chat-search-clear" type="button">Clear</button>
            <button id="popout-chat-btn" type="button" title="Pop out chat to floating window">dY"O Pop Out</button>
          </div>
          <div id="chat-search-results" class="search-results hidden" aria-live="polite"></div>
          <div id="chat-window"></div>
          <form id="chat-form" class="chat-message-form">
            <div class="message-box">
              <label class="message-upload" for="chat-attachment" title="Attach file">
                <input type="file" id="chat-attachment" accept="image/*,.txt,.json" />
                <svg viewBox="0 0 337 337" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <circle stroke-width="20" stroke="currentColor" fill="none" r="158.5" cy="168.5" cx="168.5" />
                  <path stroke-linecap="round" stroke-width="25" stroke="currentColor" d="M167.759 79V259" />
                  <path stroke-linecap="round" stroke-width="25" stroke="currentColor" d="M79 167.138H259" />
                </svg>
              </label>
              <input id="chat-input" class="message-input" placeholder="Teach Pal..." autocomplete="off" />
              <button type="submit" class="message-send" aria-label="Send message">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 664 663" aria-hidden="true">
                  <path fill="none" d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888" />
                  <path stroke-linejoin="round" stroke-linecap="round" stroke-width="33.67" stroke="#ffffff" d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888" />
                </svg>
              </button>
            </div>
          </form>
        </div>

        <aside class="chat-column chat-insights" aria-label="Pal insight center">
          <div class="chat-insight-card emotion-center">
            <div class="insight-header">
              <div class="insight-title">
                <h2>Emotion Center</h2>
                <p class="insight-subtitle">Live mood and intensity</p>
              </div>
              <button class="glow-action" type="button" data-target-tab="brain">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M12 19c4.5 0 8-2.5 8-7s-3.5-7-8-7-8 2.5-8 7 3.5 7 8 7z" stroke-width="1.5"/>
                  <path d="M9 11l3 3 3-3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Open Brain Tab
                <span class="tooltip">Jump straight into the WebGL brain visualization with your current profile context.</span>
              </button>
            </div>
            <div class="insight-body">
              <div class="emotion-display" id="emotion-display">
                <div class="emotion-icon" id="emotion-icon">😊</div>
                <div class="emotion-details">
                  <div class="emotion-mood" id="emotion-mood">Pal is calm</div>
                  <div class="emotion-bar">
                    <div class="emotion-fill" id="emotion-fill" style="width: 50%"></div>
                  </div>
                </div>
              </div>
              <div class="emotion-summary" id="emotion-summary" aria-live="polite">
                Tune in to see how Pal is feeling moment to moment.
              </div>
            </div>
          </div>

          <div class="chat-insight-card chat-insight-card--fill">
            <div class="insight-header">
              <div class="insight-title">
                <h2>Thinking Canvas</h2>
                <p class="insight-subtitle">Peek inside Pal&apos;s inner world</p>
              </div>
              <div class="insight-view-toggle" role="tablist" aria-label="Thinking canvas view">
                <button type="button" class="insight-view-btn active" data-insight-view="neurons" role="tab" aria-selected="true" id="insight-tab-neurons" aria-controls="insight-panel-neurons">Neurons</button>
                <button type="button" class="insight-view-btn" data-insight-view="emotions" role="tab" aria-selected="false" id="insight-tab-emotions" aria-controls="insight-panel-emotions">Emotions</button>
                <button type="button" class="insight-view-btn" data-insight-view="thoughts" role="tab" aria-selected="false" id="insight-tab-thoughts" aria-controls="insight-panel-thoughts">Thoughts</button>
                <button type="button" class="insight-view-btn" data-insight-view="memories" role="tab" aria-selected="false" id="insight-tab-memories" aria-controls="insight-panel-memories">Memories</button>
              </div>
            </div>
            <div class="insight-body">
              <div class="insight-view active" data-insight-content="neurons" role="tabpanel" id="insight-panel-neurons" aria-labelledby="insight-tab-neurons" aria-hidden="false">
                <div class="insight-placeholder" id="insight-neurons">
                  Neural activity preview will appear here once available.
                </div>
              </div>
              <div class="insight-view" data-insight-content="emotions" role="tabpanel" id="insight-panel-emotions" aria-labelledby="insight-tab-emotions" aria-hidden="true">
                <div class="insight-placeholder" id="insight-emotions">
                  Emotional patterns and cycles will display here.
                </div>
              </div>
              <div class="insight-view" data-insight-content="thoughts" role="tabpanel" id="insight-panel-thoughts" aria-labelledby="insight-tab-thoughts" aria-hidden="true">
                <div class="insight-placeholder" id="insight-thoughts">
                  Key thoughts in progress will surface here.
                </div>
              </div>
              <div class="insight-view" data-insight-content="memories" role="tabpanel" id="insight-panel-memories" aria-labelledby="insight-tab-memories" aria-hidden="true">
                <div class="insight-placeholder" id="insight-memories">
                  Recent memory updates and anchors will be summarized here.
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <section id="tab-stats" class="tab">
      <div class="pal-advancement-card">
        <h3>Pal Advancement</h3>
        <div class="advancement-content">
          <div class="advancement-info">
            <div class="advancement-row">
              <span class="advancement-label">Current Level</span>
              <span class="advancement-value" id="advancement-level">0</span>
            </div>
            <div class="advancement-row">
              <span class="advancement-label">Experience Points</span>
              <span class="advancement-value" id="advancement-xp">0 / 100</span>
            </div>
            <div class="advancement-row">
              <span class="advancement-label">XP to Next Level</span>
              <span class="advancement-value highlight" id="advancement-remaining">100</span>
            </div>
          </div>
          <div class="advancement-progress">
            <div class="progress-bar-container">
              <div class="progress-bar-fill" id="advancement-progress-bar" style="width: 0%"></div>
              <div class="progress-bar-text" id="advancement-progress-text">0%</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="stats">
        <div class="stat-box">
          <div>Level</div>
          <div id="stat-level">0</div>
        </div>
        <div class="stat-box">
          <div>XP</div>
          <div id="stat-xp">0</div>
        </div>
        <div class="stat-box">
          <div>CP</div>
          <div id="stat-cp">0</div>
        </div>
        <div class="stat-box">
          <div>Vocabulary</div>
          <div id="stat-vocab">0</div>
        </div>
      </div>
      
      <div class="current-emotion-card">
        <h3>Current Emotional State</h3>
        <div class="emotion-display-large">
          <div class="emotion-icon-large" id="stat-emotion-icon">😊</div>
          <div class="emotion-info">
            <div class="emotion-label">Mood</div>
            <div class="emotion-value" id="stat-emotion-mood">Calm</div>
            <div class="emotion-label">Intensity</div>
            <div class="emotion-bar-large">
              <div class="emotion-fill" id="stat-emotion-fill" style="width: 50%"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="progress-dashboard">
        <div class="chart-card">
          <h3>XP Over Time</h3>
          <canvas id="xpChart" height="200"></canvas>
        </div>
        <div class="chart-card">
          <h3>Conversations per Day</h3>
          <canvas id="convoChart" height="200"></canvas>
        </div>
      </div>
      
      <canvas id="personalityChart" width="400" height="400"></canvas>
    </section>

    <section id="tab-brain" class="tab">
      <div class="brain-tabs">
        <button type="button" data-brain-tab="concepts" class="brain-tab-btn active">Knowledge Base</button>
        <button type="button" data-brain-tab="neural" class="brain-tab-btn">Neural Activity</button>
      </div>
      
      <!-- Knowledge Base Sub-Tab (existing brain graph) -->
      <div id="brain-tab-concepts" class="brain-tab-content active">
        <div class="brain-toolbar">
          <button id="refresh-brain" type="button">Refresh Graph</button>
          <div class="brain-search">
            <input id="brain-search-input" type="text" placeholder="Search concepts..." />
            <button id="brain-search-clear" type="button" title="Clear search">✕</button>
          </div>
          <div class="brain-filter-controls">
            <label class="filter-label">
              <span>Min Frequency:</span>
              <input id="filter-min-freq" type="range" min="1" max="20" value="1" />
              <span id="filter-freq-value">1</span>
            </label>
            <label class="filter-label">
              <input id="filter-show-isolated" type="checkbox" checked />
              <span>Show Isolated</span>
            </label>
            <select id="concept-category-filter">
              <option value="all">All Concepts</option>
              <option value="high-freq">High Frequency (10+)</option>
              <option value="recent">Recently Used</option>
              <option value="connected">Well Connected (5+)</option>
            </select>
          </div>
          <span id="brain-summary">Nodes: 0 · Links: 0 · Memories: 0</span>
        </div>
        <div class="brain-layout">
          <div class="brain-graph-card">
            <div id="brain-graph"></div>
          </div>
          <aside class="brain-sidebar">
            <div class="brain-info">
              <h3 class="collapsible-header">
                How to read this graph
                <button class="collapse-btn" type="button" aria-label="Toggle info">−</button>
              </h3>
              <div class="collapsible-content">
                <p id="brain-description">Nodes represent the words and concepts Pal hears most often. Links connect words that commonly appear together.</p>
                <ul>
                  <li><strong>Size</strong>: frequency of the word.</li>
                  <li><strong>Color</strong>: interaction recency.</li>
                  <li><strong>Edges</strong>: shared context strength.</li>
                </ul>
              </div>
            </div>
            <div class="brain-memories">
              <div class="brain-memories-header">
                <h3>Recent Memories</h3>
              </div>
              <div class="memory-search">
                <input id="memory-search-input" type="text" placeholder="Search memories..." />
              </div>
              <div id="memory-list" class="memory-list"></div>
            </div>
          </aside>
        </div>
      </div>
      
      <!-- Neural Activity Sub-Tab (NEW) -->
      <div id="brain-tab-neural" class="brain-tab-content">
        <div class="neural-toolbar">
          <button id="refresh-neural" type="button">Refresh</button>
          <div class="neural-search">
            <input id="neural-search-input" type="text" placeholder="Search neurons..." />
            <button id="neural-search-clear" type="button" title="Clear search">✕</button>
          </div>
          <div class="neural-filter-controls">
            <label class="filter-label">
              <input id="filter-excitatory" type="checkbox" checked />
              <span>Excitatory</span>
            </label>
            <label class="filter-label">
              <input id="filter-inhibitory" type="checkbox" checked />
              <span>Inhibitory</span>
            </label>
            <select id="region-filter">
              <option value="all">All Regions</option>
              <option value="sensory">Sensory Input</option>
              <option value="language">Language Center</option>
              <option value="association">Association Cortex</option>
              <option value="frontal">Frontal Lobe</option>
              <option value="amygdala">Amygdala</option>
              <option value="memory">Memory Systems</option>
              <option value="motor">Motor Output</option>
            </select>
          </div>
          <span id="neural-summary">Neurons: 0 · Regions: 7 · Firings: 0</span>
        </div>
        <div class="neural-container">
          <div class="neural-visualization">
            <div id="neural-network-graph" style="width: 100%; height: 100%;"></div>
          </div>
          <aside class="neural-sidebar">
            <div class="neural-info">
              <h3>Neural Network</h3>
              <p>Watch Pal's brain regions fire in real-time as thoughts are processed.</p>
              <div class="region-legend">
                <h4>Brain Regions</h4>
                <div class="legend-item">
                  <span class="legend-color" style="background: #64b5f6"></span>
                  <span>Sensory Input</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color" style="background: #9c27b0"></span>
                  <span>Language Center</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color" style="background: #66bb6a"></span>
                  <span>Association Cortex</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color" style="background: #5b6fd8"></span>
                  <span>Frontal Lobe</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color" style="background: #e91e63"></span>
                  <span>Amygdala</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color" style="background: #ff9800"></span>
                  <span>Memory Systems</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color" style="background: #00bcd4"></span>
                  <span>Motor Output</span>
                </div>
              </div>
            </div>
            <div class="neural-stats">
              <h4>Network Stats</h4>
              <div class="stat-row">
                <span>Total Neurons:</span>
                <span id="neural-total">0</span>
              </div>
              <div class="stat-row">
                <span>Total Firings:</span>
                <span id="neural-firings">0</span>
              </div>
              <div class="stat-row">
                <span>Most Active:</span>
                <span id="neural-most-active">—</span>
              </div>
              <button id="regenerate-neural" class="neural-action-btn" type="button">🧠 Regenerate Neural Network</button>
            </div>
            <div class="neural-events">
              <div class="neural-events-header">
                <h4>Recent Activity</h4>
                <div class="replay-controls">
                  <label class="replay-toggle">
                    <input id="neural-zoom-toggle" type="checkbox" />
                    <span>Zoom on replay</span>
                  </label>
                  <div class="timeline-menu">
                    <button id="neural-playback-menu" class="timeline-button" type="button">Timeline ▾</button>
                    <div id="neural-playback-dropdown" class="timeline-dropdown hidden">
                      <button data-playback="latest" type="button">Play Latest Activity</button>
                      <button data-playback="last5" type="button">Play Last 5 Firings</button>
                      <button data-playback="last10" type="button">Play Last 10 Firings</button>
                      <button data-playback="all" type="button">Play Full Timeline</button>
                      <div class="dropdown-divider"></div>
                      <button id="neural-stop-playback" type="button">Stop Playback</button>
                    </div>
                  </div>
                </div>
              </div>
              <div id="neural-event-list" class="event-list"></div>
            </div>
          </aside>
        </div>
      </div>
    </section>

    <section id="tab-journal" class="tab">
      <div class="journal-toolbar">
        <div class="brain-tabs">
          <button class="brain-tab-btn active" data-journal-tab="thoughts" type="button">Thoughts</button>
          <button class="brain-tab-btn" data-journal-tab="ideas" type="button">Ideas</button>
          <button class="brain-tab-btn" data-journal-tab="personality" type="button">Personality</button>
          <button class="brain-tab-btn" data-journal-tab="people" type="button">People</button>
          <button class="brain-tab-btn" data-journal-tab="interests" type="button">Interests</button>
        </div>
        <button id="refresh-journal" type="button">Refresh</button>
        <span id="journal-summary">Thoughts: 0</span>
        <span class="help-icon" title="Journal shows Pal's internal thought process, ideas, personality traits, people it knows, and topics of interest.">ⓘ</span>
      </div>
      
      <div id="journal-tab-thoughts" class="brain-tab-content active">
        <div id="journal-entries" class="journal-list"></div>
      </div>
      
      <div id="journal-tab-ideas" class="brain-tab-content">
        <div id="journal-ideas" class="journal-list">
          <p class="memory-empty">Ideas and insights Pal has formed will appear here...</p>
        </div>
      </div>
      
      <div id="journal-tab-personality" class="brain-tab-content">
        <div id="journal-personality" class="journal-list">
          <p class="memory-empty">Personality traits and characteristics will appear here...</p>
        </div>
      </div>
      
      <div id="journal-tab-people" class="brain-tab-content">
        <div id="journal-people" class="journal-list">
          <p class="memory-empty">People Pal knows about will appear here...</p>
        </div>
      </div>
      
      <div id="journal-tab-interests" class="brain-tab-content">
        <div id="journal-interests" class="journal-list">
          <p class="memory-empty">Topics and interests Pal has developed will appear here...</p>
        </div>
      </div>
    </section>

    <section id="tab-settings" class="tab">
      <div class="settings-container">
        <h2>Settings</h2>
        
        <div class="settings-section glass-panel">
          <h3>Appearance</h3>
          <label>
            <span>Theme</span>
            <select id="theme-select">
              <option value="dark">Dark (Default)</option>
              <option value="midnight">Midnight Blue</option>
              <option value="ocean">Ocean</option>
              <option value="forest">Forest</option>
              <option value="sunset">Sunset</option>
            </select>
          </label>
          <label>
            <span>Font Family</span>
            <select id="font-select">
              <option value="system-ui">System Default</option>
              <option value="'Segoe UI', sans-serif">Segoe UI</option>
              <option value="'Roboto', sans-serif">Roboto</option>
              <option value="'Open Sans', sans-serif">Open Sans</option>
              <option value="'Fira Code', monospace">Fira Code (Mono)</option>
              <option value="'Courier New', monospace">Courier New</option>
            </select>
          </label>
          <label class="slider-group">
            <span>Text Size</span>
            <input id="text-size" type="range" min="12" max="20" value="16" step="1" />
            <span id="text-size-value">16px</span>
          </label>
          <div class="settings-row">
            <span class="settings-label">Glass glow surfaces</span>
            <label class="switch">
              <input type="checkbox" id="setting-glow" checked>
              <span class="slider"></span>
            </label>
          </div>
          <div class="settings-row stack">
            <span class="settings-label">Accent palette</span>
            <div class="radio-pill-group">
              <label class="radio-pill">
                <input type="radio" name="accent-palette" value="synthwave" checked>
                <span>Synthwave</span>
              </label>
              <label class="radio-pill">
                <input type="radio" name="accent-palette" value="aurora">
                <span>Aurora</span>
              </label>
              <label class="radio-pill">
                <input type="radio" name="accent-palette" value="embers">
                <span>Embers</span>
              </label>
            </div>
          </div>
          <div class="settings-row">
            <span class="settings-label">
              Favourite layout
              <span class="inline-tooltip" data-tooltip="Use the star to pin your preferred dashboard arrangement.">Beta</span>
            </span>
            <label for="layout-favorite" class="star-toggle" title="Star layout">
              <input type="checkbox" id="layout-favorite">
              <svg class="star-outline" viewBox="0 0 24 24"><path d="M12 2.5L9.45 8.5L3 9.06L7.725 13.39L6.25 19.82L12 16.5L17.75 19.82L16.275 13.39L21 9.06L14.55 8.5L12 2.5ZM12 4.75L14 9.33L18.7 9.75L15 13.07L16.18 17.75L12 15.16L7.82 17.75L9 13.07L5.3 9.75L10 9.33L12 4.75Z"/></svg>
              <svg class="star-filled" viewBox="0 0 24 24"><path d="M12 2.5L9.45 8.5L3 9.06L7.725 13.39L6.25 19.82L12 16.5L17.75 19.82L16.275 13.39L21 9.06L14.55 8.5L12 2.5Z"/></svg>
              <svg class="star-celebrate" viewBox="0 0 24 24"><circle cx="12" cy="4" r="1.5"/><circle cx="20" cy="10" r="1.5"/><circle cx="4" cy="10" r="1.5"/><circle cx="12" cy="20" r="1.5"/></svg>
            </label>
          </div>
          <label class="checkbox-label">
            <input id="smooth-scrolling" type="checkbox" checked />
            <span>Smooth Scrolling</span>
          </label>
          <label class="checkbox-label">
            <input id="reduced-motion" type="checkbox" />
            <span>Reduce Animations</span>
          </label>
          <p class="help-text">Customize the look and feel of MyPal to your preference.</p>
        </div>

        <div class="settings-section glass-panel">
          <h3>Learning & Development</h3>
          <label class="slider-group">
            <span>Learning Speed Multiplier</span>
            <input id="xp-multiplier" type="range" min="1" max="250" value="1" />
            <span id="xp-multiplier-value">1x</span>
          </label>
          <p class="help-text">Controls how quickly Pal gains XP and levels up. Higher values = faster development.</p>
        </div>

        <div class="settings-section glass-panel">
          <h3>AI Provider</h3>
          <label>
            <span>Provider</span>
            <select id="api-provider">
              <option value="local">Local Only (default)</option>
              <option value="ollama">Ollama (Local AI - Recommended)</option>
              <option value="openai">OpenAI</option>
              <option value="azure">Azure OpenAI</option>
              <option value="gemini">Google Gemini</option>
            </select>
          </label>
          <div id="model-selector-container" class="hidden">
            <label>
              <span>Model <button type="button" id="refresh-models" class="inline-btn" title="Refresh models">🔄</button></span>
              <select id="ai-model">
                <option value="">Loading models...</option>
              </select>
            </label>
            <div id="model-status" class="status-indicator"></div>
          </div>
          <label id="api-key-container">
            <span>API Key</span>
            <input id="api-key" type="password" placeholder="Optional — stored locally" />
          </label>
          <div id="ollama-setup-hint" class="help-text info-box hidden">
            <strong>💡 Ollama Setup:</strong> 
            <ol>
              <li>Install Ollama from <a href="https://ollama.ai" target="_blank">ollama.ai</a></li>
              <li>Run: <code>ollama run llama3.2:3b</code></li>
              <li>Ollama will auto-start on localhost:11434</li>
            </ol>
            <p>Recommended for your system (32GB RAM, RTX 4050): <strong>llama3.2:3b</strong> or <strong>phi3.5:3.8b</strong></p>
          </div>
          <p class="help-text">Optional: Configure AI provider for natural, contextual responses. Local-only mode uses simple pattern matching.</p>
        </div>

        <div class="settings-section glass-panel">
          <h3>Privacy & Security</h3>
          <label class="checkbox-label">
            <input id="telemetry" type="checkbox" />
            <span>Enable Telemetry (opt-in)</span>
          </label>
          <label class="checkbox-label">
            <input id="auth-required" type="checkbox" />
            <span>Require login for sensitive actions</span>
          </label>
          <p class="help-text">Telemetry helps improve MyPal. All data stays local unless explicitly enabled.</p>
        </div>

        <div class="settings-section">
          <h3>Profile Management</h3>
          <div class="settings-actions">
            <button id="switch-profile" class="secondary">Switch Profile</button>
          </div>
          <p class="help-text">Return to profile selection menu to switch between your Pals.</p>
        </div>

        <div class="settings-section">
          <h3>Actions</h3>
          <div class="settings-actions">
            <button id="save-settings" class="primary">Save Settings</button>
            <button id="export-memory">Export Memory</button>
            <button id="reset-pal" class="danger">Reset Pal</button>
          </div>
          <p class="help-text danger-text">⚠️ Reset Pal will permanently delete all data, conversations, and progress.</p>
        </div>
        
        <div class="settings-section glass-panel auth-card">
          <h3>Authenticate</h3>
          <form id="settings-auth-form" class="auth-form" autocomplete="off">
            <div class="auth-field">
              <label for="auth-email">Email</label>
              <div class="auth-input">
                <span class="auth-icon" aria-hidden="true">📧</span>
                <input type="email" id="auth-email" placeholder="Enter your email" />
              </div>
            </div>
            <div class="auth-field">
              <label for="auth-password">Password</label>
              <div class="auth-input">
                <span class="auth-icon" aria-hidden="true">🔒</span>
                <input type="password" id="auth-password" placeholder="Enter your password" />
              </div>
            </div>
            <div class="auth-options">
              <label class="checkbox-label">
                <input type="checkbox" id="auth-remember" />
                <span>Remember this device</span>
              </label>
              <button type="button" class="text-link" id="auth-reset">Forgot password?</button>
            </div>
            <button type="submit" class="accent-button auth-submit">Sign In</button>
            <p class="auth-helper">Need an account? <button type="button" class="text-link" id="auth-signup">Request access</button></p>
          </form>
        </div>
        <div class="settings-section glass-panel about-section">
          <div class="about-logo">
            <img src="../media/images/logos/v2/logo_v2_transparent.png" alt="MyPal Logo" />
          </div>
          <h3>About MyPal</h3>
          <p class="about-text">An evolving AI companion that learns and grows with you.</p>
          <p class="about-version">Version 0.1.0 (Dev Build)</p>
          <p class="about-copyright">© 2025 MyPal Project</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <small>Stage 0–1 MVP — Local prototype</small>
  </footer>

  <!-- Connectivity/status modal -->
  <div id="status-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="status-title">
    <div class="modal-card">
      <h2 id="status-title">Backend Not Reachable</h2>
      <p>
        The local server at <code>http://localhost:3001</code> is not responding.
        Please start the backend (see README) and try again.
      </p>
      <div class="loader-orbs" aria-hidden="true">
        <span class="orb"></span>
        <span class="orb"></span>
        <span class="orb"></span>
        <span class="orb"></span>
      </div>
      <div class="modal-actions">
        <button id="retry-connection" type="button">Retry</button>
        <button id="dismiss-connection" type="button">Dismiss</button>
      </div>
    </div>
  </div>

  <!-- Neural Network Regeneration Modal -->
  <div id="neural-regen-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="neural-regen-title">
    <div class="modal-card neural-regen-card">
      <h2 id="neural-regen-title">🧠 Generating Neural Network</h2>
      <p class="neural-regen-subtitle">This may take a while...</p>
      
      <div class="progress-container">
        <div class="progress-bar">
          <div id="neural-regen-progress" class="progress-fill" style="width: 0%"></div>
          <span id="neural-regen-percent" class="progress-text">0%</span>
        </div>
      </div>
      
      <div class="neural-regen-status">
        <div class="status-message" id="neural-regen-message">Initializing...</div>
        <div class="status-eta" id="neural-regen-eta">Calculating time remaining...</div>
      </div>
      
      <div class="neural-regen-phase">
        <span class="phase-label">Phase:</span>
        <span id="neural-regen-phase" class="phase-value">Starting</span>
      </div>
      
      <div class="modal-actions">
        <button id="neural-regen-close" class="primary" type="button" disabled>Close</button>
      </div>
    </div>
  </div>

  <!-- Floating Chat Modal -->
  <div id="floating-chat-modal" class="floating-chat-modal hidden">
    <div class="floating-chat-header">
      <span class="floating-chat-title">💬 Chat with Pal</span>
      <button id="close-floating-chat" class="close-floating-btn" type="button" title="Close floating chat">✕</button>
    </div>
    <div class="floating-chat-body">
      <div class="emotion-display-mini" id="emotion-display-floating">
        <div class="emotion-icon-mini" id="emotion-icon-floating">😊</div>
        <div class="emotion-mood-mini" id="emotion-mood-floating">Pal is calm</div>
      </div>
      <div id="floating-chat-window"></div>
      <form id="floating-chat-form" class="chat-message-form">
        <div class="message-box">
          <label class="message-upload" for="floating-chat-attachment" title="Attach file">
            <input type="file" id="floating-chat-attachment" accept="image/*,.txt,.json" />
            <svg viewBox="0 0 337 337" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <circle stroke-width="20" stroke="currentColor" fill="none" r="158.5" cy="168.5" cx="168.5" />
              <path stroke-linecap="round" stroke-width="25" stroke="currentColor" d="M167.759 79V259" />
              <path stroke-linecap="round" stroke-width="25" stroke="currentColor" d="M79 167.138H259" />
            </svg>
          </label>
          <input id="floating-chat-input" class="message-input" placeholder="Type a message..." autocomplete="off" />
          <button type="submit" class="message-send" aria-label="Send message">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 664 663" aria-hidden="true">
              <path fill="none" d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888" />
              <path stroke-linejoin="round" stroke-linecap="round" stroke-width="33.67" stroke="#ffffff" d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888" />
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Developer tools panel (toggle with Ctrl+D) -->
  <div id="dev-panel" class="dev-panel hidden">
    <div class="dev-row"><strong>Backend:</strong> <span id="dev-backend-status">unknown</span></div>
    <div class="dev-row"><strong>API Provider:</strong> <span id="dev-api-provider">local</span></div>
    <div class="dev-row"><button id="dev-ping" type="button">Ping Health</button></div>
    <div class="dev-row">
      <input id="auth-user" placeholder="username" />
      <input id="auth-pass" placeholder="password" type="password" />
      <button id="auth-register" type="button">Register</button>
      <button id="auth-login" type="button">Login</button>
      <button id="auth-logout" type="button">Logout</button>
    </div>
    <div class="dev-row"><small id="auth-status">Not logged in</small></div>
  </div>
  </div> <!-- End main-app -->

  <!-- Graph library -->
</body>
</html>
